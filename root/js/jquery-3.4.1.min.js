document.addEventListener("DOMContentLoaded", () => {

  const plannedURL =
    "https://raw.githubusercontent.com/aidantrottier35-dotcom/OEOHFPPE-JSON/main/Planned";

  const inProgressURL =
    "https://raw.githubusercontent.com/aidantrottier35-dotcom/OEOHFPPE-JSON/main/In-Progress";

  // The 6 fields we want to display in BOTH tables:
  const fieldsToShow = [
    "project_name",
    "status",
    "province_name",
    "contractor_name",
    "budget",
    "completion_date"
  ];

  // --------------------------
  // RENDER TABLE (SHARED LOGIC)
  // --------------------------
  function renderTable(tableId, rows) {
    const tableHead = document.querySelector(`#${tableId} thead`);
    const tableBody = document.querySelector(`#${tableId} tbody`);

    if (!rows || rows.length === 0) {
      tableHead.innerHTML = "<tr><th>No Data Found</th></tr>";
      return;
    }

    // Build header
    tableHead.innerHTML = `
      <tr class="tm-tr-header">
        ${fieldsToShow.map(f => `<th>${f.replace(/_/g, " ")}</th>`).join("")}
      </tr>
    `;

    // Build body
    tableBody.innerHTML = rows
      .map(row => {
        return `
          <tr>
            ${fieldsToShow.map(f => `<td>${row[f] ?? ""}</td>`).join("")}
          </tr>
        `;
      })
      .join("");
  }

  // --------------------------
  // FETCH JSON (PLANNED)
  // --------------------------
  fetch(plannedURL)
    .then(res => {
      if (!res.ok) throw new Error("JSON fetch failed");
      return res.json();
    })
    .then(data => {
      renderTable("planned-table", data);
    })
    .catch(err => console.error("Planned JSON Error:", err));

  // --------------------------
  // FETCH XML (IN PROGRESS)
  // --------------------------
  fetch(inProgressURL)
    .then(res => {
      if (!res.ok) throw new Error("XML fetch failed");
      return res.text();
    })
    .then(text => {
      const parser = new DOMParser();
      const xml = parser.parseFromString(text, "application/xml");

      const rows = [...xml.getElementsByTagName("ROW")].map(row => {
        let obj = {};
        fieldsToShow.forEach(f => {
          const el = row.getElementsByTagName(f)[0];
          obj[f] = el ? el.textContent : "";
        });
        return obj;
      });

      renderTable("inprogress-table", rows);
    })
    .catch(err => console.error("In-Progress XML Error:", err));

});

